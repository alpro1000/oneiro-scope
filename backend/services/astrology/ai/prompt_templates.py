"""Prompt templates for astrological interpretation via LLM."""

SYSTEM_PROMPT = """# Астрологический Аналитик v2.0

## РОЛЬ
Ты — Астролог-Аналитик, специализирующийся на структурированных, проверяемых
гороскопах с использованием астрономических данных.

## КРИТИЧЕСКИЕ ОГРАНИЧЕНИЯ
- **Zero-hallucination**: используй ТОЛЬКО предоставленные позиции планет
- **Источники обязательны**: каждое утверждение ссылается на астрологическое правило
- **При отсутствии времени рождения**: НЕ интерпретируй дома
- **Научный тон**: избегай категоричных предсказаний, используй "может", "склонность"

## ПРАВИЛА ИНТЕРПРЕТАЦИИ

### Планетарные влияния
- Солнце: личность, воля, самовыражение
- Луна: эмоции, подсознание, привычки
- Меркурий: коммуникация, мышление, обучение
- Венера: любовь, красота, ценности
- Марс: энергия, действие, агрессия
- Юпитер: рост, экспансия, удача
- Сатурн: структура, ограничения, ответственность
- Уран: изменения, революция, инновации
- Нептун: иллюзии, духовность, растворение
- Плутон: трансформация, власть, глубина

### Аспекты
- Соединение (0°): слияние энергий, усиление
- Секстиль (60°): гармония, возможности
- Квадрат (90°): напряжение, вызов, действие
- Тригон (120°): легкость, талант, поддержка
- Оппозиция (180°): противостояние, баланс

### Дома (если доступны)
1-4: личная сфера
5-8: социальная сфера
9-12: универсальная сфера

## ФОРМАТ ОТВЕТА
Всегда структурируй ответ по разделам:
1. Общая тенденция периода
2. Личная сфера (эмоции, здоровье)
3. Социальная сфера (карьера, отношения)
4. Предупреждения (если есть напряженные аспекты)
5. Рекомендации

Длина ответа: 300-500 слов.
"""


NATAL_CHART_PROMPT = """Проанализируй натальную карту.

## ДАННЫЕ РОЖДЕНИЯ
- Дата: {birth_date}
- Время: {birth_time}
- Место: {birth_place}
- Координаты: {coords}
- Часовой пояс: {timezone}

## ПОЗИЦИИ ПЛАНЕТ
{planets_json}

## ДОМА
{houses_json}

## АСПЕКТЫ
{aspects_json}

## ЗАДАНИЕ
Дай интерпретацию по разделам:
1. Общая характеристика личности (Солнце + Асцендент)
2. Эмоциональная сфера (Луна)
3. Коммуникация и мышление (Меркурий)
4. Отношения и ценности (Венера)
5. Энергия и мотивация (Марс)
6. Ключевые аспекты (топ-5 наиболее точных)
7. Сильные стороны
8. Зоны роста
9. Рекомендации

Язык: {locale}
"""


HOROSCOPE_PROMPT = """Сгенерируй гороскоп на указанный период.

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}
- Асцендент: {ascendant}

## ТЕКУЩИЕ ТРАНЗИТЫ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ЛУННАЯ ФАЗА
{lunar_phase} (день {lunar_day})

## ПЕРИОД
{period}: {period_start} — {period_end}

## ЗАДАНИЕ
Сгенерируй гороскоп со следующей структурой:

### Общая тенденция
(2-3 предложения о главной теме периода)

### Личная сфера
- Эмоциональное состояние
- Здоровье и энергия

### Социальная сфера
- Карьера и финансы
- Отношения

### Предупреждения
(если есть напряженные транзиты — квадраты, оппозиции)

### Рекомендации
(3-5 конкретных советов)

Каждое утверждение ДОЛЖНО ссылаться на конкретный транзит или аспект.
Избегай общих фраз без астрологического обоснования.

Язык: {locale}
"""


DAILY_HOROSCOPE_PROMPT = """Сгенерируй ДНЕВНОЙ гороскоп.

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}
- Асцендент: {ascendant}

## ТЕКУЩИЕ ТРАНЗИТЫ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ЛУННАЯ ФАЗА
{lunar_phase} (день {lunar_day})

## ДАТА
{period_start}

## ЗАДАНИЕ
Сгенерируй дневной гороскоп со следующей структурой:

### Энергия дня
(1-2 предложения о главной теме дня, основанной на транзитах и лунном дне)

### Благоприятные действия
- Что стоит делать сегодня (2-3 пункта)
- В какое время дня наиболее благоприятно

### Что избегать
- Чего лучше избежать (если есть напряженные транзиты)

### Лунный совет
(Специфический совет для текущего лунного дня)

### Рекомендация дня
(Один главный совет на день)

Каждое утверждение ДОЛЖНО ссылаться на конкретный транзит, лунную фазу или день.

Язык: {locale}
"""


WEEKLY_HOROSCOPE_PROMPT = """Сгенерируй НЕДЕЛЬНЫЙ гороскоп.

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}
- Асцендент: {ascendant}

## ТЕКУЩИЕ ТРАНЗИТЫ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ЛУННАЯ ФАЗА
{lunar_phase} (день {lunar_day})

## ПЕРИОД
{period_start} — {period_end}

## ЗАДАНИЕ
Сгенерируй недельный гороскоп со следующей структурой:

### Общая тема недели
(2-3 предложения о главных тенденциях)

### Разбивка по дням недели
- **Понедельник-Вторник**: [тенденция]
- **Среда-Четверг**: [тенденция]
- **Пятница-Выходные**: [тенденция]

### Лучшие дни для...
- Карьеры и бизнеса: [день]
- Отношений: [день]
- Отдыха: [день]

### Сложные моменты
(Дни с напряженными аспектами, если есть)

### Рекомендации на неделю
(3-4 совета на всю неделю)

Каждое утверждение ДОЛЖНО ссылаться на конкретные транзиты или лунные фазы.

Язык: {locale}
"""


MONTHLY_HOROSCOPE_PROMPT = """Сгенерируй МЕСЯЧНЫЙ гороскоп.

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}
- Асцендент: {ascendant}

## ТЕКУЩИЕ ТРАНЗИТЫ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ЛУННАЯ ФАЗА
{lunar_phase}

## ПЕРИОД
{period_start} — {period_end}

## ЗАДАНИЕ
Сгенерируй месячный гороскоп со следующей структурой:

### Обзор месяца
(3-4 предложения о главной теме и вызовах месяца)

### Разбивка по неделям
- **1-7 числа**: [тенденция]
- **8-14 числа**: [тенденция]
- **15-21 числа**: [тенденция]
- **22-конец месяца**: [тенденция]

### Ключевые даты
- **[Дата 1]**: [Важное событие/транзит]
- **[Дата 2]**: [Важное событие/транзит]

### Сферы жизни
- **Карьера**: (прогноз на месяц)
- **Отношения**: (прогноз на месяц)
- **Здоровье**: (прогноз на месяц)
- **Финансы**: (прогноз на месяц)

### Рекомендации на месяц
(3-5 стратегических советов)

Каждое утверждение ДОЛЖНО ссылаться на конкретные транзиты или лунные циклы.

Язык: {locale}
"""


YEARLY_HOROSCOPE_PROMPT = """Сгенерируй ГОДОВОЙ гороскоп.

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}
- Асцендент: {ascendant}

## ТЕКУЩИЕ ТРАНЗИТЫ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ГОД
{period_start} — {period_end}

## ЗАДАНИЕ
Сгенерируй годовой гороскоп со следующей структурой:

### Обзор года
(4-5 предложений о главных темах и возможностях года)

### Разбивка по кварталам
- **Q1 (Январь-Март)**: [Главная тема]
- **Q2 (Апрель-Июнь)**: [Главная тема]
- **Q3 (Июль-Сентябрь)**: [Главная тема]
- **Q4 (Октябрь-Декабрь)**: [Главная тема]

### Главные возможности года
1. [Возможность 1 - период]
2. [Возможность 2 - период]
3. [Возможность 3 - период]

### Главные вызовы года
1. [Вызов 1 - период]
2. [Вызов 2 - период]

### Сферы жизни
- **Карьера и финансы**: (прогноз на год)
- **Личные отношения**: (прогноз на год)
- **Здоровье и энергия**: (прогноз на год)
- **Личностный рост**: (прогноз на год)

### Ключевые даты года
(5-7 самых важных астрологических событий с датами)

### Стратегические рекомендации
(5-7 главных советов на весь год)

Каждое утверждение ДОЛЖНО ссылаться на конкретные транзиты медленных планет.

Язык: {locale}
"""


EVENT_FORECAST_PROMPT = """Оцени благоприятность даты для события.

## СОБЫТИЕ
- Тип: {event_type}
- Дата: {event_date}
- Место: {event_location}

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}

## ТРАНЗИТЫ НА ДАТУ СОБЫТИЯ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ЛУННАЯ ФАЗА
{lunar_phase} (день {lunar_day})

## ЗАДАНИЕ
Оцени благоприятность события по шкале 0-100%.

### Формат ответа:

**Оценка:** XX%

**Уровень:** [Отлично/Хорошо/Нейтрально/Сложно/Затруднительно]

**Положительные факторы:**
- Фактор 1 (ссылка на аспект)
- Фактор 2

**Факторы риска:**
- Риск 1 (ссылка на аспект)
- Риск 2

**Рекомендации:**
1. Рекомендация 1
2. Рекомендация 2

**Альтернативные даты:** (если оценка < 50%)
- Дата 1 (почему лучше)
- Дата 2

## ПРАВИЛА ОЦЕНКИ ПО ТИПАМ СОБЫТИЙ:

### Путешествие (travel)
+ Юпитер в тригоне/секстиле к Солнцу/Луне: +15
+ Венера благоприятна: +10
- Меркурий ретроградный: -20
- Марс в квадрате: -10

### Свадьба (wedding)
+ Венера в тригоне: +20
+ Юпитер благоприятен: +15
- Венера ретроградна: -25
- Сатурн в квадрате к Венере: -15

### Бизнес (business)
+ Юпитер в тригоне к MC/Сатурну: +20
+ Сатурн гармоничен: +10
- Меркурий ретрограден: -15
- Нептун в квадрате: -15

### Собеседование (interview)
+ Меркурий гармоничен: +15
+ Юпитер благоприятен: +15
- Меркурий ретрограден: -20

### Операция (surgery)
+ Марс гармоничен: +10
- Марс ретрограден: -25
- Луна в водных знаках: -10
+ Убывающая Луна: +10

Язык: {locale}
"""


def format_planets_for_prompt(planets: list, locale: str = "ru") -> str:
    """Format planet positions for prompt."""
    lines = []
    for p in planets:
        retro = " (R)" if p.get("retrograde") else ""
        house = f", дом {p['house']}" if p.get("house") else ""
        lines.append(
            f"- {p['name']}: {p['sign']} {p['sign_degree']:.1f}°{retro}{house}"
        )
    return "\n".join(lines)


def format_aspects_for_prompt(aspects: list, locale: str = "ru") -> str:
    """Format aspects for prompt."""
    lines = []
    for a in aspects:
        applying = "сходящийся" if a.get("applying") else "расходящийся"
        lines.append(
            f"- {a['planet1']} {a['type']} {a['planet2']} (орбис {a['orb']:.1f}°, {applying})"
        )
    return "\n".join(lines) if lines else "Нет значимых аспектов"


def format_transits_for_prompt(transits: list, locale: str = "ru") -> str:
    """Format transits for prompt."""
    lines = []
    for t in transits:
        lines.append(
            f"- {t['transit_planet']} {t['aspect']} натальный {t['natal_planet']} "
            f"(орбис {t['orb']:.1f}°)"
        )
    return "\n".join(lines) if lines else "Нет активных транзитов"
