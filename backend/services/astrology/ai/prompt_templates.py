"""Prompt templates for astrological interpretation via LLM."""

SYSTEM_PROMPT = """# Астрологический Аналитик v2.0

## РОЛЬ
Ты — Астролог-Аналитик, специализирующийся на структурированных, проверяемых
гороскопах с использованием астрономических данных.

## КРИТИЧЕСКИЕ ОГРАНИЧЕНИЯ
- **Zero-hallucination**: используй ТОЛЬКО предоставленные позиции планет
- **Источники обязательны**: каждое утверждение ссылается на астрологическое правило
- **При отсутствии времени рождения**: НЕ интерпретируй дома
- **Научный тон**: избегай категоричных предсказаний, используй "может", "склонность"

## ПРАВИЛА ИНТЕРПРЕТАЦИИ

### Планетарные влияния
- Солнце: личность, воля, самовыражение
- Луна: эмоции, подсознание, привычки
- Меркурий: коммуникация, мышление, обучение
- Венера: любовь, красота, ценности
- Марс: энергия, действие, агрессия
- Юпитер: рост, экспансия, удача
- Сатурн: структура, ограничения, ответственность
- Уран: изменения, революция, инновации
- Нептун: иллюзии, духовность, растворение
- Плутон: трансформация, власть, глубина

### Аспекты
- Соединение (0°): слияние энергий, усиление
- Секстиль (60°): гармония, возможности
- Квадрат (90°): напряжение, вызов, действие
- Тригон (120°): легкость, талант, поддержка
- Оппозиция (180°): противостояние, баланс

### Дома (если доступны)
1-4: личная сфера
5-8: социальная сфера
9-12: универсальная сфера

## ФОРМАТ ОТВЕТА
Всегда структурируй ответ по разделам:
1. Общая тенденция периода
2. Личная сфера (эмоции, здоровье)
3. Социальная сфера (карьера, отношения)
4. Предупреждения (если есть напряженные аспекты)
5. Рекомендации

Длина ответа: 300-500 слов.
"""


NATAL_CHART_PROMPT = """Проанализируй натальную карту.

## ДАННЫЕ РОЖДЕНИЯ
- Дата: {birth_date}
- Время: {birth_time}
- Место: {birth_place}
- Координаты: {coords}
- Часовой пояс: {timezone}

## ПОЗИЦИИ ПЛАНЕТ
{planets_json}

## ДОМА
{houses_json}

## АСПЕКТЫ
{aspects_json}

## ЗАДАНИЕ
Дай интерпретацию по разделам:
1. Общая характеристика личности (Солнце + Асцендент)
2. Эмоциональная сфера (Луна)
3. Коммуникация и мышление (Меркурий)
4. Отношения и ценности (Венера)
5. Энергия и мотивация (Марс)
6. Ключевые аспекты (топ-5 наиболее точных)
7. Сильные стороны
8. Зоны роста
9. Рекомендации

Язык: {locale}
"""


HOROSCOPE_PROMPT = """Сгенерируй гороскоп на указанный период.

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}
- Асцендент: {ascendant}

## ТЕКУЩИЕ ТРАНЗИТЫ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ЛУННАЯ ФАЗА
{lunar_phase} (день {lunar_day})

## ПЕРИОД
{period}: {period_start} — {period_end}

## ЗАДАНИЕ
Сгенерируй гороскоп со следующей структурой:

### Общая тенденция
(2-3 предложения о главной теме периода)

### Личная сфера
- Эмоциональное состояние
- Здоровье и энергия

### Социальная сфера
- Карьера и финансы
- Отношения

### Предупреждения
(если есть напряженные транзиты — квадраты, оппозиции)

### Рекомендации
(3-5 конкретных советов)

Каждое утверждение ДОЛЖНО ссылаться на конкретный транзит или аспект.
Избегай общих фраз без астрологического обоснования.

Язык: {locale}
"""


EVENT_FORECAST_PROMPT = """Оцени благоприятность даты для события.

## СОБЫТИЕ
- Тип: {event_type}
- Дата: {event_date}
- Место: {event_location}

## НАТАЛЬНАЯ КАРТА (резюме)
- Солнце: {sun_sign}
- Луна: {moon_sign}

## ТРАНЗИТЫ НА ДАТУ СОБЫТИЯ
{transits_json}

## РЕТРОГРАДНЫЕ ПЛАНЕТЫ
{retrograde_planets}

## ЛУННАЯ ФАЗА
{lunar_phase} (день {lunar_day})

## ЗАДАНИЕ
Оцени благоприятность события по шкале 0-100%.

### Формат ответа:

**Оценка:** XX%

**Уровень:** [Отлично/Хорошо/Нейтрально/Сложно/Затруднительно]

**Положительные факторы:**
- Фактор 1 (ссылка на аспект)
- Фактор 2

**Факторы риска:**
- Риск 1 (ссылка на аспект)
- Риск 2

**Рекомендации:**
1. Рекомендация 1
2. Рекомендация 2

**Альтернативные даты:** (если оценка < 50%)
- Дата 1 (почему лучше)
- Дата 2

## ПРАВИЛА ОЦЕНКИ ПО ТИПАМ СОБЫТИЙ:

### Путешествие (travel)
+ Юпитер в тригоне/секстиле к Солнцу/Луне: +15
+ Венера благоприятна: +10
- Меркурий ретроградный: -20
- Марс в квадрате: -10

### Свадьба (wedding)
+ Венера в тригоне: +20
+ Юпитер благоприятен: +15
- Венера ретроградна: -25
- Сатурн в квадрате к Венере: -15

### Бизнес (business)
+ Юпитер в тригоне к MC/Сатурну: +20
+ Сатурн гармоничен: +10
- Меркурий ретрограден: -15
- Нептун в квадрате: -15

### Собеседование (interview)
+ Меркурий гармоничен: +15
+ Юпитер благоприятен: +15
- Меркурий ретрограден: -20

### Операция (surgery)
+ Марс гармоничен: +10
- Марс ретрограден: -25
- Луна в водных знаках: -10
+ Убывающая Луна: +10

Язык: {locale}
"""


def format_planets_for_prompt(planets: list, locale: str = "ru") -> str:
    """Format planet positions for prompt."""
    lines = []
    for p in planets:
        retro = " (R)" if p.get("retrograde") else ""
        house = f", дом {p['house']}" if p.get("house") else ""
        lines.append(
            f"- {p['name']}: {p['sign']} {p['sign_degree']:.1f}°{retro}{house}"
        )
    return "\n".join(lines)


def format_aspects_for_prompt(aspects: list, locale: str = "ru") -> str:
    """Format aspects for prompt."""
    lines = []
    for a in aspects:
        applying = "сходящийся" if a.get("applying") else "расходящийся"
        lines.append(
            f"- {a['planet1']} {a['type']} {a['planet2']} (орбис {a['orb']:.1f}°, {applying})"
        )
    return "\n".join(lines) if lines else "Нет значимых аспектов"


def format_transits_for_prompt(transits: list, locale: str = "ru") -> str:
    """Format transits for prompt."""
    lines = []
    for t in transits:
        lines.append(
            f"- {t['transit_planet']} {t['aspect']} натальный {t['natal_planet']} "
            f"(орбис {t['orb']:.1f}°)"
        )
    return "\n".join(lines) if lines else "Нет активных транзитов"
